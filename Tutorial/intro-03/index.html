<!DOCTYPE html>
<html>
<head>
</head>
<body>
    <canvas id="canvas" width="800" height="800"></canvas>

    <script src="fabric.js"></script>
    <script>
        var canvas = new fabric.Canvas('canvas');
        
        // var circle = new fabric.Circle({
        //     radius: 100,
        //     fill: '#eef',
        //     scaleY: 0.5,
        //     originX: 'center',
        //     originY: 'center'
        // });

        // var text = new fabric.Text('hello world', {
        //     fontSize: 30,
        //     originX: 'center',
        //     originY: 'center'
        // });

        // var group = new fabric.Group([ circle, text ], {
        //     left: 150,
        //     top: 100,
        //     angle: -10
        // });

        // group.item(0).set({fill: 'red'});
        // group.item(1).set({
        //     text: 'trololo',
        //     fill: 'white'
        // });

        // var rect = new fabric.Rect({ left: 150, top: 100, width: 100, height: 100, fill: '#00f'});
        
        // canvas.add(rect);

        // canvas.add(group);

        // var circle1 = new fabric.Circle({
        //     radius: 50,
        //     fill: 'red',
        //     left: 0,
        // });
        // var circle2 = new fabric.Circle({
        //     radius: 50,
        //     fill: 'green',
        //     left: 100,
        // });
        // var circle3 = new fabric.Circle({
        //     radius: 50,
        //     fill: 'blue',
        //     left: 200,
        // });

        // var group = new fabric.Group([ circle1, circle2, circle3 ], {
        //     left: 200,
        //     top: 100
        // });

        // group.add(new fabric.Rect({
        //     width: 150,
        //     height: 150,
        //     left: 0,
        //     top: 0,
        //     originX: 'center',
        //     originY: 'center'
        // }));

        // canvas.add(group);

        // canvas.add(circle1, circle2);
        // // create a group with copies of existing (2) objects
        // var group = new fabric.Group([
        //     canvas.item(0).clone(),
        //     canvas.item(1).clone()
        // ],{
        //     left: 100,
        //     top: 100
        // });

        // // remove all objects and re-render
        // canvas.clear().renderAll();

        // // add group onto canvas
        // canvas.add(group);

        // fabric.Image.fromURL('my_image.png', function(img) {
        //     var img1 = img.scale(0.3).set({ left: 100, top: 100 });

        //     fabric.Image.fromURL('my_image.png', function(img) {
        //         var img2 = img.scale(0.3).set({ left: 175, top: 175 });

        //         fabric.Image.fromURL('my_image.png', function(img) {
        //             var img3 = img.scale(0.3).set({ left: 250, top: 250 });

        //             canvas.add(new fabric.Group([ img1, img2, img3], { left: 200, top: 200 }));
        //         });
        //     });
        // });

        // canvas.add(new fabric.Circle({
        //     radius: 100,
        //     fill: 'red'
        // }));

        // canvas.add(new fabric.Rect({
        //     left: 50,
        //     top: 50,
        //     height: 20,
        //     width: 20,
        //     fill: 'green'
        // }));

        // canvas.backgroundColor = 'blue';

        // console.log( JSON.stringify(canvas) );

        // // console.log( canvas.toDataURL('png'));

        // console.log(canvas.toObject());

        // var rect = new fabric.Rect();

        // rect.toObject = (function(toObject) {
        //     return function() {
        //         return fabric.util.object.extend(toObject.call(this), {
        //             name: this.name
        //         });
        //     };
        // })(rect.toObject);

        // canvas.add(rect);

        // rect.name = 'trololo';

        // console.log(JSON.stringify(canvas));

        // console.log( rect.toObject() );

        // canvas.add(new fabric.Rect({
        //     left: 50,
        //     top: 50,
        //     height: 20,
        //     width: 20,
        //     fill: 'green'
        // }));

        // console.log(canvas.toSVG());

        // canvas.loadFromJSON('{"objects":[{"type":"rect","left":50,"top":50,"width":20,"height":20,"fill":"green","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0},{"type":"circle","left":100,"top":100,"width":100,"height":100,"fill":"red","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"radius":50}],"background":"rgba(0, 0, 0, 0)"}');

        // var img = new fabric.Path();

        // canvas.add(img);

        // canvas.item(0).sourcePath = '/assets/dragon.svg';

        // console.log(JSON.stringify(canvas.toDatalessJSON()));        

        // var Point = fabric.util.createClass({
        //     initialize: function(x, y) {
        //         this.x = x || 0;
        //         this.y = y || 0;
        //     },
        //     toString: function() {
        //         return this.x + '/' + this.y;
        //     }
        // });

        // var point = new Point(10, 20);

        // console.log(point.toString());

        // var ColoredPoint = fabric.util.createClass(Point, {
        //     initialize: function(x, y, color) {
        //         this.callSuper('initialize', x, y);
        //         this.color = color || '#000';
        //     },
        //     toString: function() {
        //         return this.callSuper('toString') + ' (color: ' + this.color + ')';
        //     }
        // });

        // var redPoint = new ColoredPoint(15, 33, '#f55');

        // console.log( redPoint.toString() );

        var LabeledRect = fabric.util.createClass(fabric.Rect, {

            type: 'labeledRect',

            labelFont: '20px Helvetica',

            labelFill: '#333',

            initialize: function(options) {
                options || (options = { });

                this.callSuper('initialize', options);

                this.set({ width: 100, height: 50 });
                this.set('label', options.label || '');
            },

            toObject: function() {
                return fabric.util.object.extend(this.callSuper('toObject'), {
                    label: this.get('label')
                });
            },

            _render: function(ctx) {
                this.callSuper('_render', ctx);

                ctx.font = this.labelFont;
                ctx.fillStyle = this.labelFill;


                ctx.fillText(this.label, -this.width/2, -this.height/2 + 20);
            }
        });

        var labeledRect = new LabeledRect({
            left: 100,
            top: 100,
            label: 'test',
            fill: '#faa'
        });
        
        canvas.add(labeledRect);

        labeledRect.set({
            label: 'trololo',
            fill: '#aaf',
            rx: 10,
            ry: 10
        });

    </script>
</body>
</html>